<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= article.title %></title>
   <link rel="stylesheet" href="/css/layout.css">
  <link rel="stylesheet" href="/css/articles/articleShow.css">
  <link rel="stylesheet" href="/css/reaction.css">
  <link rel="stylesheet" href="/css/comments.css">
</head>
<body>

  <%- include("../partials/header") %>
  
<nav class="show-header">
  <a href="/articles" class="back-link">← Back </a>
  
    
    <% if (user && article.authorId && article.authorId._id.toString() === user._id.toString()) { %>
      
        <a href="/articles/edit/<%= article._id %>" class="author-edit" >✏ Edit</a>
        <form action="/articles/delete/<%= article._id %>" method="POST" style="display:inline;">
          <button type="submit" class="author-delete" >🗑 Delete</button>
        </form>
    <% } %>

    </nav>
  

  <div class="article-container">
    <h2><%= article.title %></h2>

    <% if (article.image) { %>
      <img src="<%= article.image %>" alt="Article image">
    <% } %>

    <!-- ✅ Article content with line breaks -->
    <div class="article-content">
      <%- article.content.replace(/\n/g,'') %>
    </div>
  

    <!-- Reactions -->
    <div class="reactions" id="reactions">
      <h3>Reactions</h3>
      <% if (user) { %>
        <form action="/articles/<%= article._id %>/reactions" method="POST">
          <button type="submit" name="type" value="like" class="like">👍: <%= article.reactions.filter(r => r.type === "like").length %></button>
          <button type="submit" name="type" value="love" class="love">❤️: <%= article.reactions.filter(r => r.type === "love").length %></button>
          <button type="submit" name="type" value="dislike" class="dislike">👎:<%= article.reactions.filter(r => r.type === "dislike").length %></button>
        </form>
      <% } else { %>
        <p><a href="/users/login">Login</a> to react.</p>
        <p >
        👍: <%= article.reactions.filter(r => r.type === "like").length %>
        ❤️: <%= article.reactions.filter(r => r.type === "love").length %>
        👎:<%= article.reactions.filter(r => r.type === "dislike").length %>
        </p>
      <% } %>
      
    </div>

    

    <!-- Comments -->
    <div class="comments" id="comments">
      <h2>Comments</h2>

     <% if (user) { %>
        <form action="/articles/<%= article._id %>/comments" method="POST">
          <textarea name="text" required placeholder="Write your comment..."></textarea>
          <br>
          <button type="submit">Add Comment</button>
        </form>
      <% } else { %>
        <p><a href="/users/login">Login</a> to add a comment.</p>
      <% } %>


      <% if (article.comments.length > 0) { %>
        <ul>
          <% article.comments.forEach(comment => { %>
            <li>
              <strong><%= comment.author ? comment.author.username : "Anonymous" %><%=comment.author.name %>:</strong>
              <%= comment.text %>
              <% if (user && comment.author && user._id.toString() === comment.author._id.toString()) { %>
                <a href="/articles/<%= article._id %>/comments/<%= comment._id %>/edit" class="edit-comment">✏ Edit</a>
                <form action="/articles/<%= article._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST" style="display:inline;">
                  <button type="submit" class="delete-comment">🗑 Delete</button>
                </form>
              <% } %>
            </li>
          <% }) %>
        </ul>
      <% } else { %>
        <p>No comments yet.</p>
      <% } %>
    </div>

    
  </div>

</body>
</html>
